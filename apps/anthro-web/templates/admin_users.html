{% extends "base.html" %}
{% block content %}
<h1 class="mb-4"><i class="bi bi-shield-lock me-2"></i>Admin – Felhasználók</h1>

<div class="row">
  <div class="col-lg-5">
    <div class="card shadow-sm mb-4">
      <div class="card-header fw-semibold">Új felhasználó</div>
      <div class="card-body">
        <form method="post" action="{{ url_for('admin_create_user') }}">
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input class="form-control" type="email" name="email" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Felhasználónév</label>
            <input class="form-control" type="text" name="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Jelszó</label>
            <input class="form-control" type="text" name="password" required>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" name="is_admin" id="is_admin">
            <label class="form-check-label" for="is_admin">Admin jogosultság</label>
          </div>
          <button class="btn btn-primary" type="submit">Létrehozás</button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-header fw-semibold">Felhasználói lista</div>
      <div class="card-body table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Email</th>
              <th>Felhasználónév</th>
              <th>Admin</th>
              <th>Létrehozva</th>
              <th>Műveletek</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
            <tr>
              <td>{{ u.id }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.username }}</td>
              <td>
                {% if u.is_admin %}
                  <span class="badge bg-success">Igen</span>
                {% else %}
                  <span class="badge bg-secondary">Nem</span>
                {% endif %}
              </td>
              <td>{{ (u.created_at or '') }}</td>
              <td style="white-space:nowrap;">
                <form class="d-inline" method="post" action="{{ url_for('admin_reset_password', user_id=u.id) }}">
                  <input type="hidden" name="new_password" value="ChangeMe123!">
                  <button class="btn btn-sm btn-outline-warning" type="submit" title="Jelszó reset (példa)">
                    <i class="bi bi-key"></i>
                  </button>
                </form>
                {% if current_user.id != u.id %}
                <form class="d-inline" method="post" action="{{ url_for('admin_delete_user', user_id=u.id) }}" onsubmit="return confirm('Biztos törlöd?');">
                  <button class="btn btn-sm btn-outline-danger" type="submit" title="Törlés">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
                {% else %}
                  <span class="text-muted small">Saját fiók</span>
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="text-muted">Nincs felhasználó.</td></tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="small text-muted">
          Tipp: a jelszó reset gomb csak példa (beégetett „ChangeMe123!”). Átírhatod modálisra / valódi beviteli mezőre.
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
